<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Unity</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="../css/reveal.css">
		<link rel="stylesheet" href="../css/theme/black.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="../lib/css/zenburn.css">
		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? '../css/print/pdf.css' : '../css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

        <section>
          <p>Making games with Unity</p>
          <h3>NPC chat + Inventory stuff</h3>
          <p><small><a href="../index.html">back</a></small></p>
        </section>

        <section>
          <h2>This week:</h2>
          <p class="fragment">Click on an NPC to interact</p>
					<p class="fragment">Text appears on the screen</p>
          <p class="fragment">A simple inventory \ global state system</p>
        </section>

        <section>
          <h2>Game of the week</h2>
          <p><a target="_blank" href="https://fisho.itch.io/alien">ALIEN CASENO</a> by Grace Bruxner</p>
        </section>

				<section>
					<h2>Pre-setup</h2>
					<p class="fragment">If you don't already have a basic scene with a player, let's make one:</p>
					<p class="fragment">Make an empty scene</p>
					<p class="fragment">Add a Plane to start on</p>
					<p class="fragment">Import the standard characters and add a First Person Controller</p>
					<p class="fragment">Remember to delete the Main Camera</p>
					<p class="fragment">Test: You can run around the simple scene</p>
				</section>


				<section>
					<h2>Setup</h2>
					<p class="fragment">Add our NPCs: Cubey the Car Dealer and Capsule the Shopkeeper</p>
					<p class="fragment">Add the 3D objects and rename them</p>
					<p class="fragment">Put them close to the First Person Controller so you can test quickly.</p>
				</section>

				<section>
					<h2>First-person click script</h2>
					<p>When the player clicks:</p>
					<p class="fragment">We draw a 3D line out from the middle of the camera and record what it hits.</p>
					<p class="fragment">If it hits something tagged 'Clickable', we send a message to that object.</p>
					<p class="fragment">We'll write it step by step.</p>
				</section>

				<section>
					<h2>Player Click Script v1</h2>
					<p>Add a new script to the First Person Controller</p>
<pre><code>void Update () {
  if (Input.GetMouseButtonDown(0)) {
    print ("Click detected!");
  }
}
</code></pre>

	<p>Reference: <a target="_blank" href="https://docs.unity3d.com/ScriptReference/Input.html">Unity Docs</a></p>
        </section>

				<section>
					<h2>Player Click Script v2</h2>
<pre><code>void Update () {
  if (Input.GetMouseButtonDown(0)) {
    RaycastHit hitInfo = new RaycastHit ();
    Vector3 middleOfScreen = new Vector3 (0.5f, 0.5f, 0f);
    Ray ray = Camera.main.ViewportPointToRay(middleOfScreen);
    bool isHit = Physics.Raycast (ray, out hitInfo);
    print(hitInfo.collider);
  }
}
</code></pre>
	<p>Reference: <a target="_blank" href="https://docs.unity3d.com/ScriptReference/Camera.ViewportPointToRay.html">Unity Docs</a></p>
        </section>

				<section>
					<h2>Player Click Script v3</h2>
          <p>Now we need to tag clickable game objects with the tag 'Clickable'. And we'll send them a message.</p>
<pre><code>void Update () {
  if (Input.GetMouseButtonDown(0)) {
    RaycastHit hitInfo = new RaycastHit ();
    Vector3 middleOfScreen = new Vector3 (0.5f, 0.5f, 0f);
    Ray ray = Camera.main.ViewportPointToRay(middleOfScreen);
    bool isHit = Physics.Raycast (ray, out hitInfo);

    if (isHit &amp;&amp; hitInfo.collider.gameObject.tag.Equals ("Clickable")) {
      print ("Clickable!");
      hitInfo.collider.gameObject.SendMessage("Click");
    } else {
      print ("Not clickable");
    }
  }
}
</code></pre>
	<p>Reference: <a target="_blank" href="https://docs.unity3d.com/ScriptReference/GameObject.SendMessage.html">Unity Docs</a></p>
        </section>


<section>
  <h2>Clickable objects v1</h2>
  <p>1. Must be tagged 'Clickable'. This is how our clicking script knows that they are clickable.</p>
  <p>2. Must have a script with a function called Click. This function will run when they are clicked, because we call it using SendMessage.</p>
<pre><code>void Click() {
  print("You clicked me"); //just a test
}
  </code></pre>
</section>

<section>
  <h2>Clickable objects v2</h2>
<pre><code>using UnityEngine.UI;

public class CarDealer : MonoBehaviour {
	public Text chatText;

	void Start () {
		chatText.text = "";
	}

	void Click () {
		chatText.text = "I am a car dealer!";
	}
}
</code></pre>
  <p>Add a Text to the scene. Drag it into the chatText slot of this script.</p>
</section>

<section>
  <h2>Clickable objects v3</h2>
  <p>We use a <a target="_blank" href="https://docs.unity3d.com/Manual/Coroutines.html">coroutine</a> to make the text appear then disappear. Coroutines are functions that can stop and wait, then come back later.</p>
<pre><code>using UnityEngine.UI;

public class CarDealer : MonoBehaviour {
	public Text chatText;

	void Start () {
		chatText.text = "";
	}

	void Click () {
		StartCoroutine (WelcomeConvo ());
	}

	IEnumerator WelcomeConvo () {
		chatText.text = "I am a car dealer!";
		yield return new WaitForSeconds (2);
		chatText.text = "";
	}
}
</code></pre>
</section>

<section>
  <h2>Sharing information</h2>
  <p>We want every script to have access to some shared information:</p>
  <p>1. How much money the player has</p>
  <p>2. Does the player character like apples or bananas the most?</p>
</section>

<section>
  <h2>QuestInfo script</h2>
  <p>Create an empty game object in the scene. Name it 'QuestObject'. Add a script named QuestInfo. Give the script these public variables (and no functions)</p>
<pre><code>public class QuestInfo : MonoBehaviour {
	public int Money;
	public bool PlayerLikesApples;
}</code></pre>
</section>

<section>
  <h2>QuestInfo script</h2>
  <p>You can change the values in the Unity editor, to help test things quicky:</p>
  <img src="quest-info-testing.png">
</section>

<section>
  <h2>Connecting scripts</h2>
  <p>Let the Car Dealer know about QuestInfo. Add this to the Car Dealer code:</p>
<pre><code>...
	public QuestInfo questInfo;
}</code></pre>
  <p>Drag the QuestObject in to the slot, so it knows where to find the information:</p>
  <img src="set-quest-info.png">
</section>

<section>
  <h2>Using those variables</h2>
  <p>We can now use those variables in our car dealer class:</p>
<pre><code>
IEnumerator WelcomeConvo () {
    if (questInfo.Money > 10) {
      chatText.text = "Want to buy a car?";
      yield return new WaitForSeconds (2);
      chatText.text = "";
    } else {
      chatText.text = "Come back when you have $10.";
      yield return new WaitForSeconds (2);
      chatText.text = "";
    }
}
</code></pre>
</section>

<section>
  <h2>Connecting scripts v2</h2>
  <p>I get tired of dragging QuestInfo object into every script that needs QuestInfo. Let's make them link up automatically!</p>
<pre><code>
//Replace the word 'public' with 'private'
private QuestInfo questInfo;

void Start () {
  //automatically link up at the start of the game:
  questInfo = FindObjectOfType(typeof(QuestInfo));
}
</code></pre>
</section>


      </div>
    </div>

    <script src="../lib/js/head.min.js"></script>
    <script src="../js/reveal.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        transition: 'slide', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: '../lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: '../plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: '../plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: '../plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: '../plugin/zoom-js/zoom.js', async: true },
          { src: '../plugin/notes/notes.js', async: true }
        ]
      });

    </script>

  </body>
</html>
